---
layout: post
title: "[操作系统]文件系统：文件的操作"
date: 2023-02-14 12:40 +0800
author: jamie109
categories: [CS_course, OS]
tags: [CS course note, wangdao]
mermaid: true
math: true
---
## 1.文件的基本操作    
### 创建文件(creat)   
进行Create系统调用时，需要提供**所需外存空间大小、文件存储路径、文件名**    
OS主要做两件事：

1. 在外存中找到文件所需的空间。    
2. 根据文件路径找到对应目录，创建文件对应的目录项。

### 删除文件(delete)   
需要提供参数：**文件存储路径、文件名**   
OS：   
1. 根据路径找到目录文件，找到文件名对应的目录项    
2. 回收文件占用的磁盘块     
3. 删除目录项

### 打开文件(open)   
**文件存储路径、文件名、对文件的操作（r只读、rw读写等）**
1. 根据路径找到目录文件，找到文件名对应的目录项，检测用户权限（如果用户没有这种操作权限，拒绝）    
2. 将目录项**复制到该进程在内存中的打开文件表**中，返回表目编号(索引号/文件描述符)   

![20230214124913](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230214124913.png)   

### 关闭文件(close)   

1. 删除**该进程的打开文件表中对应项**    
2. 回收分配给该文件的内存空间等资源     
3. **系统打开文件表**的打开计数器count-=1(归零时删除该项)   

### 读文件(read)   
**在读文件之前，需要先打开文件。**

* 需提供进程打开文件表中的索引号，读入的数据量，数据在内存中存放的位置。

* 从**读指针**指向的外存位置读取指定大小的数据到指定的内存区域。

### 写文件(write)    
**在写文件之前，需要先打开文件。**

需要提供打开文件表中的索引号，写出的数据量，写回外存的数据位置(写指针指向的)。

### 总结

![20230214125514](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230214125514.png)   

## 2.文件共享   
### 基于索引结点的共享(硬链接)   
![20230214192532](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230214192532.png)    
### 基于符号链的共享(软链接)   
![](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/202302141928308.png)    
**软链接方式访问共享文件要查询多级目录，会有多次IO，会比较慢。**

## 3.文件保护   
### 口令保护    
FCB中保存口令，访问时与用户提供的口令对比。优点：保存口令的空间开销小，验证时间开销也小。缺点：不够安全（有人入侵系统）。

### 加密保护    
**用密码对文件数据流加密，访问时用“正确”的密码解密。**比如异或加密。**系统中保存的是加密过的数据**。 如果用户用错误的密码解密，获得的数据就是错误的。    
优点：保密性强，不需要存储密码。缺点：加密/解密要花费一定的时间。

### 访问控制    
每个文件FCB中增加一个**访问控制表(ACL)，控制各用户的访问权限**。记录各个用户可以对该文件执行哪些操作。   

计算机中有很多个用户时，使用**精简的访问列表，以组为单位，标记其访问权限**，比如Linux里面分成所有者，所属组，其他人。   

## 4.文件系统的结构层次    
![20230214194147](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230214194147.png)   
![20230214194510](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230214194510.png)

> thanks for [B站王道计算机教育](https://www.bilibili.com/video/BV1YE411D7nH?p=8&spm_id_from=pageDriver&vd_source=38881132948112534788036151fc388f)
