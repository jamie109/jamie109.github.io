---
layout: post
title: "[计算机网络]TCP拥塞控制：RENO算法状态机"
date: 2023-03-01 21:37 +0800
author: jamie109
categories: [CS_course, CN]
tags: [computer network]
mermaid: true
math: true
---

>考试复习到这里了，有些难度，记录一下。

![20230301213831](https://cdn.jsdelivr.net/gh/jamie109/my-img/for-VSCode/20230301213831.png)    

* 有三个状态：慢启动、拥塞控制、快速恢复    
* 状态转移的条件：超时、3次重复ACK、cwnd ≥ ssthresh、新ACK

先从最简单的开始，进入**快速恢复**状态只有一个条件：3次重复ACK，实际上是四个ACK（一次初始的ACK，三个重复的ACK），这个快速恢复其实是跟TCP快速重传联系在一起的。进入快速恢复时，**阈值 = 窗口/2，窗口 = 阈值+3**，注意这里是加三。

在快速恢复状态下，每收到一个重复ACK（导致它进入快速恢复状态的重复的ACK），窗口+1。如果又收到了新的ACK，就可以从快速恢复状态出去了，去**拥塞控制**状态，那么把阈值大小赋给窗口，即窗口=阈值。如果超时了，就进入**慢启动**状态，**阈值 = 窗口/2，窗口 = 1**，注意这里窗口是一。其实所有超时都会进入慢启动。      

慢启动，建立连接就会进入慢启动状态，窗口初始值为一。如果有新的ACK，来一个ACK窗口就加一，这时候窗口大小在快速增长。如果有重复的ACK，不管他，直到3个重复ACK，进入快速恢复（阈值 = 窗口/2，窗口 = 阈值+3）。超时了，仍然是慢启动，只不过需要修改阈值和窗口（阈值 = 窗口/2，窗口 = 1）。因为窗口会增长，所以当它大于等于阈值的时候，我们进入拥塞控制阶段（阈值和窗口都不用改）。

拥塞控制阶段，这时候窗口增长的就慢了。超时就进入慢启动，阈值=窗口/2，窗口=1。如果有重复的ACK，不管他，三次重复ACK就进入快速恢复，阈值 = 窗口/2，窗口 = 阈值+3。收到一个新的ACK，窗口 = 窗口 + MSS/窗口（这里可以理解为每次增一小块儿，比如1/5。当把这个窗口中的所有东西都发过去并且都收到ACK了，这个窗口才增长一个MSS，也就是窗口+1）。     

* 关于窗口和阈值的变化       
1. 只要是超时，就把窗口一半赋给阈值，窗口大小为1，进入慢启动     
2. 窗口大于阈值（只在慢启动状态下），进入拥塞控制，窗口阈值无变化    
3. 三次重复ACK（慢启动和拥塞控制），进入快速恢复，把窗口一半赋给阈值，窗口大小为阈值加三    
4. 重复ACK（快速恢复），窗口加一      
5. 新的ACK（快速恢复），窗口 = 阈值，进入拥塞控制
6. 新的ACK（慢启动），每来一个ACK，窗口加一    
7. 新的ACK（拥塞控制），每来一个ACK，窗口+=MSS/窗口    
   